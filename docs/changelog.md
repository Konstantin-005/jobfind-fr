## [2025-11-16] - CI/CD деплой на VPS (e77.top) через GitHub Actions
### Добавлено
- Workflow `.github/workflows/deploy.yml`: сборка на Node 18, архивирование артефактов, SCP на VPS, деплой в `/www/wwwroot/e77.top`, перезапуск `pm2` под именем `e77-top`. Переменные NEXT_PUBLIC_* не используются.

### Изменено
- Перевод фронтенд API на относительные пути (`API_BASE_URL = ''`) для работы через rewrite.
- Обновление `next.config.js`: rewrite `/api/:path* -> http://localhost:8081/api/:path*` через `afterFiles`.

### Исправлено
- Исключены хардкоды `http://localhost:8080` в API-клиенте.

## [2025-11-15] - Просмотр резюме: клиентский редирект при отсутствии токена
### Добавлено
- 

### Изменено
- Уточнена документация по странице `app/resume/[id]/page.tsx`: вход защищён проверкой токена на клиенте с использованием `useRouter`.

### Исправлено
- Сборка больше не падает из-за отсутствующего `router` при обращении к `router.push('/login')` в `app/resume/[id]/page.tsx` — используем хук `useRouter` и корректные проверки.

## [2025-11-15] - Редактирование резюме: обработчик должности
### Добавлено
- 

### Изменено
- Документация о поведении поля «Желаемая должность» обновлена с учётом автодополнения и обязательного обработчика изменения значения.

### Исправлено
- При редактировании резюме на странице `app/resume/[id]/edit/page.tsx` будет добавлен обработчик `handleTitleChange`, чтобы устранить ошибку типизации при сборке.

## [2025-11-15] - Фикс загрузки логотипа компании
### Добавлено
- 

### Изменено
- Актуализирована документация по форме профиля компании с описанием структуры объекта `logo` в состоянии.

### Исправлено
- При загрузке логотипа на странице `app/employer/addcompany/page.tsx` теперь всегда заполняется свойство `logo.url`, что устраняет ошибку типизации при сборке.

## [2025-11-15] - Устранение ошибок сборки (useSearchParams и конфигурация Next.js)
### Добавлено
- План обновления клиентских страниц `/profile`, `/employer/mycompany`, `/vacancy` с внедрением `<Suspense>` и выносом логики `useSearchParams` в отдельные компоненты для корректной работы при статической генерации.

### Изменено
- Документация (plan, architecture) дополнена описанием требований к клиентским компонентам, использующим `useSearchParams`, и уточнена стратегия конфигурации Next.js без устаревшего ключа `experimental.telemetry`.
- Принято решение оставить `/vacancy` полностью клиентской: вынесена логика в `VacancyClient` и добавлен серверный `page.tsx` с `<Suspense>` для корректного prerender.

### Исправлено
- Удалён невалидный ключ `telemetry` в `next.config.js`. Подготовлены правки для устранения падений `next build`, связанных с отсутствием `<Suspense>` вокруг `useSearchParams`.

## [2025-11-10] - Детальная страница вакансии /vacancy/[id] (SSR)
### Добавлено
- Страница `/vacancy/[id]` как серверный компонент (SSR) с загрузкой `GET /api/jobs/{job_id}`.
- Хлебные крошки в верхней части страницы по образцу макета.
- Панель действий с кнопкой «Откликнуться» (заглушка без логики), а также базовые кнопки избранного/жалобы (заглушки).
 - Skeleton загрузки `app/vacancy/[id]/loading.tsx` для клиентских переходов.
 - SEO: `generateMetadata` с формированием заголовка по названию вакансии и городу.

### Изменено
- Визуальные правки под макет: увеличенный заголовок, отступы, спокойные вторичные тексты, оформление блоков «Условия»/«Обязанности», единые радиусы и тени.

### Исправлено
- Обработка 404 (Not Found) через `notFound()` при отсутствии вакансии.

## [2025-11-10] - Редизайн UI детальной страницы вакансии
### Добавлено
- Выпадающее меню действий ("В черный список", "Пожаловаться") в панели действий.

### Изменено
- Объединены информационные блоки (заголовок/зарплата/лейблы/адрес, информация о компании, условия, описание) в один визуальный контейнер.
- Панель действий переведена на `position: sticky` внутри прокручиваемого контейнера (липнет к низу видимой области контента).
- Кнопка «В избранное» заменена на иконку сердечка.

### Исправлено
- Панель больше не перекрывает контент и не требует дополнительного нижнего паддинга у страницы.

## [2025-11-09] - Список вакансий /vacancy под новый GET /api/jobs (Вариант B)
### Добавлено
- Отображение карточек вакансий по схеме `controllers.JobListItem` (`job_id`, `company_name`, `logo_url`, `title`, `work_experience`, `salary_*`, `address`, `publication_cities`, `work_format_ids`).
- Ссылка по названию вакансии на `/vacancy/[job_id]`.
- Блок зарплаты с форматированием диапазона/от/до, периодом (`salary_period`) и типом налогообложения (`salary_type`).
- Чипы формата работы по `work_format_ids` (маппинг из `app/config/work_formats_202505222228.json`).
- Выбор города (Вариант B): приоритет `address.city`, затем первый из `publication_cities`, совпадающий с выбранными в фильтрах городами (имена получены по `city_id` через справочник), иначе первый из `publication_cities`.
- Справа в карточке: логотип компании и кнопка «Откликнуться».

### Изменено
- Адаптивная верстка карточки для мобайла и десктопа.

### Исправлено
- Устранён устаревший рендер под старую структуру (`experience_level`, `employment_type`, `work_format`).

## [2025-11-09] - Карточка вакансии: отдельная строка для города и адреса
### Изменено
- Перенесён вывод города из чипа в отдельную строку под чипами.
- Формат: `Город, адрес` при наличии полей `address.city` и `address.address`; если `address` отсутствует, используется город из логики Варианта B.
### Добавлено
- Добавлена иконка локации перед строкой адреса.

## [2025-11-09] - Диагностика /api/jobs (500 и прокси на :3000)
### Добавлено
- Задача в `docs/plan.md` по диагностике проблемы запросов `/api/jobs` и неверного проксирования на `localhost:3000` при бэкенде на `localhost:8080`.

### Изменено
- Проведён анализ `next.config.js` (rewrites `/api/*` → `http://localhost:3000/api/*`), `middleware.ts` (без влияния на /api), `app/vacancy/page.tsx` (относительный fetch `/api/jobs`).
- Подготовлено изменение стратегии переписываний: использовать `afterFiles` для проксирования `/api/*` на `http://localhost:8080`, чтобы локальные руты `app/api/*` (например, `/api/upload`) обрабатывались самим Next.

## [2025-11-08] - Редактирование вакансии: предзаполнение «Часов в день», «Регион», «Профессия»
### Изменено
- В `app/employer/vacancies/page.tsx` при загрузке полной карточки вакансии (`GET /api/companies/jobs/{id}`) добавлено предзаполнение:
  - `dayLengthIds` из `day_length_ids` или `day_lengths[{ day_length_id }]` (также сохранена поддержка `work_day_lengths`)
  - `regionIds` и видимого ввода региона из `region_ids` или `regions[{ region_id, name }]`
  - `professionInput` из `profession.name` (помимо `profession_id`)

## [2025-11-09] - Обязательность города в UI, Вариант A
### Изменено
- Swagger не изменён: обязательные поля для `/api/jobs` POST и `/api/jobs/{job_id}` PUT остаются `title`, `description`, `work_experience`.
- В `app/employer/vacancies/page.tsx` добавлена обязательность выбора города публикации на уровне UI: требуется хотя бы один город (`publicationCityIds`) или установленный `publication_city_id`.

### Исправлено
- Валидация формы теперь показывает ошибку под блоком городов при отсутствии выбранных городов и блокирует отправку.

## [2025-11-08] - Вакансии компании: корректные эндпоинты списка и детали
### Изменено
- Список вакансий компании получается через `GET /api/companies/jobs`.
- При открытии модального окна редактирования полная карточка вакансии загружается через `GET /api/companies/jobs/{id}` согласно swagger.

## [2025-11-08] - Редактирование вакансии: предзаполнение мультивыборов
### Изменено
- В `app/employer/vacancies/page.tsx` в `startEdit` добавлена инициализация массивов ID для мультивыборов из данных вакансии: `employment_type_ids`, `education_type_ids`, `work_format_ids`, `work_schedule_type_ids`, `work_schedule_ids`, `day_length_ids`, `shift_type_ids`. Поддержаны форматы API: как массивы идентификаторов, так и массивы сущностей.

### Исправлено
- При редактировании вакансии поля мультивыборов отображаются пустыми, даже если в вакансии есть связанные значения.

## [2025-11-08] - Хедер переведён на sticky и устранено перекрытие контента
### Изменено
- В `app/components/Header.tsx` заменён `fixed` на `sticky` с `top-0 z-50`, чтобы хедер оставался видимым при прокрутке и не перекрывал контент страниц (включая раздел `/employer/*`).

### Исправлено
- Перекрытие контента страниц верхним меню из-за фиксированного позиционирования.

## [2025-11-05] - Исправление ошибки хуков на странице вакансий работодателя
### Исправлено
- Перемещён ранний возврат `return null` после инициализации всех хуков в `app/employer/vacancies/page.tsx`, чтобы избежать ошибки `Rendered more hooks than during the previous render`.

## [2025-11-05] - Ограничение доступа к странице вакансий работодателя
### Добавлено
- Клиентская проверка роли на `app/employer/vacancies/page.tsx`: при `localStorage.user_type !== 'employer'` выполняется `router.replace('/login')`.

## [2025-10-28] - Синхронизация типов ID с docs/swagger
### Добавлено
- 

### Изменено
- Приведены типы идентификаторов к строкам (UUID) согласно обновлению swagger:
  - controllers.LoginResponse.user.user_id → string (UUID)
  - models.JobPosting.posted_by → string
  - models.CompanyEmployee.user_id → string
  - models.CompanyProfile.user_id → string
  - (В swagger также обновлены: models.ChatMessage.sender_id, models.ChatParticipant.user_id, models.JobApplication.applicant_id, models.JobSeekerProfile.user_id, models.User.user_id → string) 

### Исправлено
- 

## [2025-10-30] - Централизация загрузки фото резюме
### Добавлено
- Поддержка параметра `folder` в API-роуте `/api/upload` с белым списком (`companyLogo`, `photo`)
- Возврат `fileName` в ответе `/api/upload` (имя сохранённого файла без пути)
- Расширение клиентской функции `uploadFile(file, folder?)` в `app/utils/api.ts`

### Изменено
- `app/resume/add/page.tsx`: загрузка фото через `/api/upload` в `uploads/photo`, при создании резюме на бэкенд отправляется только имя файла в поле `photo_url`
- `app/resume/[id]/page.tsx`: обновление фото через `/api/upload` в `uploads/photo`, на бэкенд отправляется только имя файла в поле `photo_url`
- `app/resume/[id]/edit/page.tsx`: редактирование резюме использует ту же схему — фото загружается через `/api/upload` в `uploads/photo`, на бэкенд отправляется только имя файла `photo_url`

## [2025-10-30] - Форма вакансии: адрес компании
### Изменено
- `app/employer/vacancies/page.tsx`: поле «Адрес компании» заменено на одиночный выпадающий список с данными из `/api/companies/profile` (GET). В запрос вакансии отправляется `company_address_id` (число), контракт бэкенда не менялся.

## [2025-10-31] - Форма вакансии: автокомплит профессии
### Добавлено
- `app/employer/vacancies/page.tsx`: автокомплит поля «Профессия» с использованием `/api/dictionaries/professions/search` (GET). При выборе устанавливается `profession_id`.

## [2025-10-31] - Форма вакансии: города публикации и регионы
### Добавлено
- `app/employer/vacancies/page.tsx`: вынесены отдельные блоки
  - «Города публикации» — мультивыбор до 10, поиск по `/api/locations/cities/search`, отправка `city_ids`.
  - «Регионы» — мультивыбор до 10, отправка `region_ids`.

## [2025-10-31] - Форма вакансии: единый UX мультивыборов
### Изменено
- `app/employer/vacancies/page.tsx`: замена нативных `<select multiple>` на выпадающие мультисписки с чекбоксами для полей:
  - Тип занятости (`employment_type_ids`)
  - Уровень образования (`education_type_ids`)
  - Формат работы (`work_format_ids`)
  - График работы (`work_schedule_type_ids`)
  - Расписание (`work_schedule_ids`)
  - Часов в день (`day_length_ids`)
  - Смены (`shift_type_ids`)

## [2025-10-31] - Форма вакансии: валидация и строгий payload
### Добавлено
- Подсветка ошибок по блокам: название, описание, профессия, адрес компании, зарплата (min/max), города публикации (лимит 10), регионы (лимит 10).
- Деактивация кнопок «Создать/Сохранить» при критических ошибках.
- Строгий тип payload для submitCreate/submitEdit согласно примеру: `company_address_id`, `profession_id`, `title`, `description`, массивы `*_ids`, `city_ids`, `region_ids`, `salary_*` и прочие поля.

## [2025-11-02] - Форма вакансии: исправление адресов API
### Исправлено
- `app/employer/vacancies/page.tsx`: запросы переведены на `API_ENDPOINTS` (порт 8080):
  - Поиск профессий → `API_ENDPOINTS.dictionaries.professionsSearch`
  - Поиск городов → `API_ENDPOINTS.citiesSearch`
  - Профиль компании → `API_ENDPOINTS.companies.profile`

## [2025-11-02] - Форма вакансии: UX выбора городов
### Изменено
- `app/employer/vacancies/page.tsx`: для «Города публикации» добавлен отдельный горизонтальный блок с выбранными городами (чипы) и иконкой удаления; список опций скрывается сразу после выбора города. Реализовано закрытие дропдауна по клику вне области и запрет повторного открытия во время активного поиска.

## [2025-11-02] - Форма вакансии: UX выбора региона
### Изменено
- `app/employer/vacancies/page.tsx`: дропдаун «Регион» закрывается по клику вне области. Источник данных — `/api/locations` (GET) с фильтрацией элементов `type: 'reg'`.

## [2025-11-02] - Форма вакансии: UX поля «Профессия»
### Изменено
- `app/employer/vacancies/page.tsx`: в поле «Профессия» добавлена кнопка очистки ✕, которая снимает выбор и очищает ошибку; дропдаун закрывается по клику вне области.

## [2025-11-02] - Форма вакансии: выпадающие списки зарплаты
### Изменено
- `app/employer/vacancies/page.tsx`: поля «Частота выплаты», «Период зарплаты», «Тип зарплаты» заменены на выпадающие списки. В UI отображаются RU-лейблы, в payload отправляются EN-значения (enum).

## [2025-11-02] - Форма вакансии: закрытие выпадающих списков
### Изменено
- `app/employer/vacancies/page.tsx`: реализовано закрытие по клику вне области для: «Адрес компании», «Частота выплаты», «Период зарплаты», «Тип зарплаты», а также мультивыпадающих списков: «Тип занятости», «Уровень образования», «Формат работы», «График работы», «Расписание», «Часов в день», «Смены».

## [2025-11-02] - Форма вакансии: поле «Опыт работы»
### Добавлено
- `app/employer/vacancies/page.tsx`: добавлено обязательное поле «Опыт работы» (`work_experience`) как одиночный выпадающий список с закрытием по клику вне области. В UI отображаются RU-лейблы, в payload отправляются EN-значения.

### Исправлено
- Исключено прямое отправление бинарного файла фото в эндпоинты резюме

## [2025-10-28] - Форма вакансии: скролл и мультиселекты
### Добавлено
- Скролл содержимого модального окна на `app/employer/vacancies/page.tsx` (ограничение высоты и `overflow-y-auto`)
- Множественные выпадающие списки для полей: Тип занятости, Уровень опыта, Формат работы, График работы, Часов в день, Смены
- Справочники из БД выгружены через MCP и сохранены в `app/config/`: `work_schedules_20251028.json`, `work_schedule_types_20251028.json`, `work_day_lengths_20251028.json`, `shift_types_20251028.json`

### Изменено
- Поля формы вакансии приведены к использованию локальных справочников вместо текстового ввода

### Исправлено
- Удалены поля «Дата окончания публикации» и «Опыт работы (текст)» из формы создания/редактирования вакансии

## [2025-10-28] - Payload вакансии по swagger (controllers.JobUpsertRequest)
### Добавлено
- Реализован маппинг формы в формат бекэнда: массивы `employment_type_ids`, `education_type_ids`, `work_format_ids`, `work_schedule_type_ids`, `work_schedule_ids`, `day_length_ids`, `shift_type_ids`, `city_ids`, `region_ids`
- Добавлен мультиселект расписаний `work_schedules` (5/2, 6/1 и др.)

### Изменено
- `submitCreate`/`submitEdit` отправляют только поля, ожидаемые бекэндом (без устаревших строковых полей)

## [2025-10-28] - Валидация формы вакансии и подсказки
### Добавлено
- Клиентская валидация обязательных полей: `title`, `description`, `profession_id`, `company_address_id`; проверка `salary_min <= salary_max`
- Отображение ошибок под соответствующими полями и общее предупреждение в форме
- Подсказки под мультиселектами: "Можно выбрать несколько. Оставьте пустым, если неважно."

## [2025-10-29] - Исправление ошибки в CityAutocomplete
### Изменено
- `CityAutocomplete` обращается к `/api/locations/cities/search` вместо устаревшего `/api/locations`

### Исправлено
- Корректное использование справочного эндпоинта из `swagger.yaml`
- Исправлена ошибка "Cannot read properties of undefined (reading 'toString')" при выборе города
- Добавлена обработка случаев, когда API возвращает `city.id` вместо `city.city_id`
- Добавлена фильтрация невалидных данных от API (города без city_id или name)
- Добавлена строгая проверка типов в handleSuggestionClick
- Обновлен интерфейс City для корректного отражения типов данных

## [2025-10-26] - Форма компании: адреса и отрасли
### Добавлено
- Поля формы для создания компании с поддержкой 1+ адресов (город + адрес)
- Мультивыбор отраслей с маппингом к формату API (industries: [{ industry_id }])

### Изменено
- Payload отправки на /api/companies/profile приведён к models.CompanyProfile (website_url, logo_url, company_size, is_it_company, email, brand_name, industries[], addresses[])
- Временно исключено поле district_id из формы и из payload адресов
- `CityAutocomplete` теперь использует бекэнд на 8080 через `API_ENDPOINTS.locations` (без обращения к 3000)
 - Добавлен завершающий слэш к `API_ENDPOINTS.locations` для избежания 301 redirect
 - Удалён префикс `https://example.com/` у `logo_url`; теперь отправляется только путь к файлу
 - Серверная загрузка файлов настроена на каталог `public/uploads/companyLogo` и возвращает путь `/uploads/companyLogo/<file>`

### Исправлено
- 

## [2025-10-24] - Приведение формы вакансии к models.JobPosting
### Добавлено
- Полный набор полей в форме создания/редактирования вакансии согласно docs/swagger.yaml (models.JobPosting)

### Изменено
- Обновлены типы JobPosting в app/utils/api.ts, payload для create/update
- Поля salary_from/to заменены на salary_min/max, status на is_active

### Исправлено
- 

## [2025-10-24] - Улучшение UX создания вакансии
### Добавлено
- Кнопка добавления вакансии в пустом состоянии списка на /employer/vacancies
- Плавающая кнопка (FAB) создания вакансии для мобильных экранов

### Изменено
- Улучшена доступность действия создания вакансии

### Исправлено
-

## [2025-10-24] - Исправление списка вакансий работодателя
### Добавлено
- Нормализация ответа API для /api/companies/jobs (поддержка форматов data/items/job_postings)

### Изменено
- Защита UI от не-массивов при рендеринге списка (исправлена ошибка filtered.map is not a function)

### Исправлено
- Ошибка рантайма на странице /employer/vacancies

## [2025-10-24] - Страница вакансий работодателя и CRUD
### Добавлено
- Страница /employer/vacancies со списком вакансий компании (CRUD: просмотр/добавление/изменение/удаление)
- Базовые формы добавления и редактирования вакансий

### Изменено
- API-клиент: добавлены endpoints companiesJobs, jobById, createJob, updateJob, deleteJob

### Исправлено
-

## [2025-10-24] - Обновление ссылок навигации
### Добавлено
- 

### Изменено
- Ссылка "Моя компания" в Header ведет на /employer/mycompany

### Исправлено
-

## [2025-01-29] - Создание описания архитектуры платформы JobFind
### Добавлено
- Полное описание архитектуры платформы поиска работы
- Диаграммы архитектуры в формате Mermaid
- Структура базы данных с ER-диаграммой
- Описание взаимодействия компонентов системы
- Стратегии безопасности, производительности и масштабирования

## [2025-01-29] - Корректировка архитектуры под текущее состояние проекта
### Изменено
- Актуализировано описание архитектуры под текущую реализацию (только фронтенд)
- Убраны детали Go бэкенда и PostgreSQL, так как они не реализованы
- Добавлено описание текущих компонентов Next.js приложения
- Обновлена диаграмма архитектуры для отражения текущего состояния
- Добавлен раздел планируемого развития с описанием будущих компонентов

## [2025-01-29] - Создание плана реализации проекта
### Добавлено
- Детальный план разработки в /docs/plan.md
- Основные задачи проекта с разбивкой на этапы
- Шаги выполнения для каждой задачи с чекбоксами
- Зависимости между задачами
- Приоритизация задач согласно текущему состоянию проекта

## [2025-01-29] - Обновление дизайна интерфейса
### Изменено
- Полностью обновлен дизайн Header.tsx с современным стилем
- Добавлен логотип JobFind с градиентным дизайном
- Улучшена навигация для разных типов пользователей
- Добавлено мобильное меню для адаптивности
- Обновлена главная страница page.tsx с современным дизайном
- Добавлены секции со статистикой и преимуществами платформы
- Улучшена поисковая форма с популярными запросами
- Исправлены синтаксические ошибки в коде хедера

## [2025-10-27] - Приведение формы вакансии к структуре БД
### Добавлено
- Запланированы поля формы для связей: vacancy_day_lengths, vacancy_employment_types, vacancy_cities, vacancy_education_types, vacancy_regions, vacancy_shift_types, vacancy_work_formats, vacancy_work_schedule_types, vacancy_work_schedules
- Инициация получения значений enum из БД через MCP для: experience_level, work_experience, salary_type, salary_period, salary_frequency

### Изменено
- План обновлён: выравнивание `app/employer/vacancies/page.tsx` и типов с таблицей `job_postings` (добавлен `publish_in_all_cities`, обязательность `description`, `profession_id`, `company_address_id`, `work_experience`)

### Исправлено
- 

## [2025-10-27] - Автокомплит городов и регионов на странице вакансий
### Добавлено
- Автокомплит для поля города публикации (CityAutocomplete) на `app/employer/vacancies/page.tsx`
- Новый компонент `app/components/RegionAutocomplete.tsx` для подбора регионов через `/api/locations?query=`

### Изменено
- Поле "Город публикации (ID)" заменено на ввод с автодополнением и установкой `publication_city_id`

### Исправлено
- 
