# План реализации фронтэнда платформы поиска работы JobFind

## Задача: Фикс загрузки логотипа в форме компании
- **Статус**: Завершена
- **Описание**: Устранить ошибку типизации в `app/employer/addcompany/page.tsx`, возникающую при обновлении `logo` после загрузки файла. Гарантировать, что состояние содержит все обязательные поля и соответствует API.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan, architecture)
  - [x] Исправить типы и логику обновления `formData.logo`
  - [x] Проверить сборку `npm run build`
- **Зависимости**: `uploadFile` из `app/utils/api.ts`, контракты `CompanyProfile`

## Задача: Устранение ошибок сборки (useSearchParams и конфигурация Next.js)
- **Статус**: В процессе
- **Описание**: Исправить падение `next build`, вызванное использованием `useSearchParams()` вне `<Suspense>` на страницах `/profile`, `/employer/mycompany`, `/vacancy`, а также удалить невалидный ключ `experimental.telemetry` из `next.config.js`.
- **Шаги выполнения**:
  - [x] Актуализировать документацию (changelog, plan, architecture) с описанием необходимых изменений
  - [ ] Обновить `next.config.js`, убрав некорректные ключи и зафиксировав стратегию проксирования API
  - [ ] Перевести `/profile`, `/employer/mycompany`, `/vacancy` на CSR через `next/dynamic` с `{ ssr: false }` и клиентские компоненты `*PageClient`
  - [ ] Проверить вложенные компоненты (`JobFilters` и др.) на использование `useSearchParams`; для клиентских страниц это допустимо, SSR отключён
  - [ ] Прогнать `npm run build` и убедиться в отсутствии ошибок
- **Зависимости**: Next.js App Router, компоненты `app/profile/page.tsx`, `app/employer/mycompany/page.tsx`, `app/vacancy/page.tsx`, `app/components/JobFilters.tsx`

## Задача: Редактирование резюме — обработчик поля «Желаемая должность»
- **Статус**: Завершена
- **Описание**: Добавить отсутствующий обработчик `handleTitleChange` в `app/resume/[id]/edit/page.tsx`, чтобы автодополнение профессий работало корректно и сборка не падала по ошибке типов.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan, architecture)
  - [x] Реализовать `handleTitleChange` с вызовом поиска профессий
  - [x] Протестировать ввод и заново запустить `npm run build`
- **Зависимости**: API автодополнения профессий, локальное состояние формы резюме

## Задача: Детальная страница вакансии /vacancy/[id] (SSR)
- **Статус**: В процессе
- **Описание**: Реализовать серверный компонент страницы детального просмотра вакансии с загрузкой `GET /api/jobs/{job_id}`, хлебными крошками, блоками как на макете и кнопкой «Откликнуться»-заглушкой. Обрабатывать состояния загрузки/ошибок/404.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Создать `app/vacancy/[id]/page.tsx` (server component, SSR)
  - [ ] Добавить хлебные крошки вверху страницы
  - [ ] Сверстать разделы: заголовок/зарплата/лейблы/адрес, сведения о компании, условия, обязанности (description), требования (если появятся в API), нижняя панель действий
  - [ ] Обработать ошибки и 404 через `notFound()`
  - [ ] Визуальная проверка адаптивности
  - [ ] [A] Визуальные правки под макет (отступы, размеры шрифтов, оформление «Условия»/«Требования»)
  - [ ] [B] SEO: `generateMetadata` с заголовком на основе названия и города
  - [x] [C] Прелоадер: `app/vacancy/[id]/loading.tsx` (skeleton)
- **Зависимости**: `docs/swagger.yaml` (models.JobPosting), корректное проксирование `/api` на 8080

## Задача: Редизайн UI детальной страницы вакансии — объединение блоков и плавающая панель
- **Статус**: В процессе
- **Описание**: Объединить информацию о вакансии в один визуальный блок и сделать панель действий плавающей внизу экрана. Кнопку «В избранное» заменить иконкой сердечка, «В черный список» и «Пожаловаться» перенести в выпадающее меню.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Объединить блоки (заголовок/зарплата/лейблы/адрес + компания + условия + описание) в один контейнер
  - [ ] Сделать панель действий фиксированной у нижнего края экрана, добавить отступ контенту
  - [ ] Заменить текст «В избранное» на иконку сердечка (aria-label)
  - [ ] Перенести «В черный список» и «Пожаловаться» в выпадающее меню
  - [ ] Визуальная проверка на мобильных и десктопе
- **Зависимости**: TailwindCSS, SSR-компонент страницы

## Задача: Обновление отображения списка вакансий по /api/jobs (Вариант B)
- **Статус**: В процессе
- **Описание**: Привести страницу `/vacancy` к схеме `controllers.JobListItem`: заголовок со ссылкой на карточку, зарплата (диапазон/от/до) с периодом и типом налогообложения, компания, чипы форматов работы по `work_format_ids`, опыт по `work_experience`, адрес/город по правилу Варианта B (приоритет `address.city` → первый из `publication_cities`, совпадающий с выбранными в фильтрах, → иначе первый из `publication_cities`), логотип и кнопка «Откликнуться». Адаптивная верстка.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Обновить интерфейсы и рендер `app/vacancy/page.tsx` под новый формат
  - [ ] Реализовать маппинг городов из URL (city_id) в имена через `API_ENDPOINTS.dictionaries.citiesByIds`
  - [ ] Визуально проверить адаптивность карточек
- **Зависимости**: `docs/swagger.yaml` (controllers.JobListItem), `app/config/work_formats_202505222228.json`, наличие эндпоинта cities-by-ids

## Задача: Диагностика ошибки /api/jobs (500 и прокси на :3000)
- **Статус**: В процессе
- **Описание**: Выявить причины 500 на GET /api/jobs и неверного проксирования на localhost:3000 при бэкенде на localhost:8080. Подготовить и согласовать вариант исправления.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [x] Проанализировать next.config.js и middleware на предмет переписываний /api
  - [x] Проверить вызовы в app/vacancy/page.tsx (относительный путь vs API_ENDPOINTS)
  - [x] Согласовать вариант фикса (rewrites -> :8080 / заменить fetch на API_ENDPOINTS / создать proxy-роут в Next)
  - [ ] Изменить конфигурацию: использовать `afterFiles` для прокси `/api/:path* -> http://localhost:8080/api/:path*`, чтобы локальные `app/api/*` обрабатывались первым делом (учёт `/api/upload`)
  - [ ] Реализовать выбранный вариант и протестировать
- **Зависимости**: Корректный доступ к бэкенду на http://localhost:8080, актуальный swagger


## Задача: Обязательность города при создании/редактировании вакансии (Вариант A)
- **Статус**: Завершена
- **Описание**: Привести валидацию UI к Варианту A: swagger не изменяется (обязательные `title`, `description`, `work_experience`), на уровне UI город публикации обязателен (требуется хотя бы один город или `publication_city_id`).
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [x] Добавить проверку обязательности города в `validate()` и `hasCriticalErrors` на `app/employer/vacancies/page.tsx`
  - [x] Показ ошибки под блоком городов и блокировка отправки формы
- **Зависимости**: Актуальная схема `controllers.JobUpsertRequest` в `docs/swagger.yaml`

## Задача: Вакансии компании — список/деталь по Companies endpoints
- **Статус**: В процессе
- **Описание**: Получение списка вакансий через `GET /api/companies/jobs`, а при открытии редактирования — загрузка полной карточки через `GET /api/companies/jobs/{id}` (с предзагрузкой связей) согласно swagger.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Добавить `companies.jobById(id)` в `API_ENDPOINTS`
  - [ ] Добавить `jobsApi.getCompanyJob(id)`
  - [ ] В `startEdit` загружать полную карточку и переинициализировать форму и мультивыборы
- **Зависимости**: Актуальный swagger, наличие Bearer токена

## Задача: Редактирование вакансии — предзаполнение мультивыборов
- **Статус**: В процессе
- **Описание**: При открытии редактирования вакансии заполнять мультивыборы из данных вакансии: тип занятости, уровень образования, формат работы, график работы, расписание, часов в день, смены. Поддержать форматы API (массивы ID и массивы сущностей).
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Инициализировать массивы `employment_type_ids`, `education_type_ids`, `work_format_ids`, `work_schedule_type_ids`, `work_schedule_ids`, `day_length_ids`, `shift_type_ids` в `startEdit`
  - [ ] Ручная проверка на нескольких вакансиях
- **Зависимости**: Структура ответа API вакансии (поддержка связей)

## Задача: Устранение наложения хедера на контент (перевод на sticky)
- **Статус**: В процессе
- **Описание**: Перевести `app/components/Header.tsx` с позиционирования `fixed` на `sticky` с `top-0 z-50`, чтобы хедер всегда оставался видимым при прокрутке и не перекрывал контент страниц (включая раздел `/employer/*`).
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Заменить `fixed` на `sticky` в `Header.tsx`
  - [ ] Провести визуальную проверку страниц работодателя на разных ширинах
- **Зависимости**: TailwindCSS классы, отсутствие конфликтующих глобальных стилей

## Задача: Ограничение доступа к /employer/vacancies
- **Статус**: Завершена
- **Описание**: Клиентская проверка роли `user_type === 'employer'` на странице `app/employer/vacancies/page.tsx`. При несоответствии выполняется редирект на `/login`.
- **Шаги выполнения**:
  - [x] Добавить проверку `localStorage` и редирект через `router.replace('/login')`
  - [x] Обновить документацию (changelog, plan)
- **Зависимости**: Наличие `localStorage.user_type`

## Задача: Синхронизация типов ID с документацией swagger
- **Статус**: В процессе
- **Описание**: Привести типы фронтенда к обновлённой схеме API: идентификаторы пользователей и связанные поля теперь строки (UUID). Затрагиваются: controllers.LoginResponse.user.user_id, models.JobPosting.posted_by, models.CompanyEmployee.user_id, models.CompanyProfile.user_id. 
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Обнови
<truncated 9028 bytes>
агрузка фото через `uploadFile(..., 'photo')`, отправлять `photo_url`=имя файла
  - [ ] `app/resume/[id]/page.tsx`: загрузка фото через `uploadFile(..., 'photo')`, обновлять резюме `photo_url`=имя файла
- **Зависимости**: Наличие публичной папки `public/uploads/photo`, корректный бэкенд-эндпоинт резюме

## Задача: Разработка системы коммуникации
- **Статус**: Не начата
- **Описание**: Реализация чата и системы уведомлений между пользователями
- **Шаги выполнения**:
  - [ ] Создание чат-комнат между соискателем и работодателем
  - [ ] Реальное время обмена сообщениями
  - [ ] Система уведомлений
  - [ ] Push уведомления в браузере
  - [ ] История переписки
  - [ ] Статус сообщений (прочитано/непрочитано)
  - [ ] Файловые вложения в чате
- **Зависимости**: Готовая система откликов на вакансии

## Задача: Интеграция с базой данных
- **Статус**: Не начата
- **Описание**: 
- **Шаги выполнения**:
  - [ ] Интеграция с Go API сервером
- **Зависимости**: Готовый Go API сервер

## Задача: Оптимизация производительности и SEO
- **Статус**: Частично завершена
- **Описание**: Улучшение производительности и поисковой оптимизации
- **Шаги выполнения**:
  - [x] Настройка Next.js App Router с оптимизацией
  - [x] Базовая SEO оптимизация страниц
  - [ ] Настройка ISR для динамических страниц
  - [ ] Оптимизация изображений и ресурсов
  - [ ] Настройка кеширования
  - [ ] Мониторинг производительности
  - [ ] Генерация sitemap и robots.txt
- **Зависимости**: Стабильная работа фронтенда

## Задача: Тестирование и развертывание
- **Статус**: Не начата
- **Описание**: Подготовка к продакшену и развертыванию
- **Шаги выполнения**:
  - [ ] Написание unit тестов
  - [ ] Интеграционные тесты API
  - [ ] E2E тестирование пользовательских сценариев
  - [ ] Настройка CI/CD pipeline
  - [ ] Контейнеризация с Docker
  - [ ] Развертывание на сервер
  - [ ] Настройка мониторинга и логирования
- **Зависимости**: Готовая полная функциональность

## Задача: Дополнительные функции и улучшения
- **Статус**: Не начата
- **Описание**: Расширение функциональности платформы
- **Шаги выполнения**:
  - [ ] Система рекомендаций вакансий
  - [ ] Расширенные фильтры поиска
  - [ ] Геолокация и поиск по регионам
  - [ ] Интеграция с соцсетями
  - [ ] Мобильное приложение (PWA)
  - [ ] Аналитическая панель для администраторов
  - [ ] Система рейтингов и отзывов
- **Зависимости**: Стабильная работа основной функциональности

## Примечания:
- Проект развивается поэтапно, начиная с фронтенда и постепенно добавляя бэкенд функциональность
- Текущий приоритет - завершение системы управления вакансиями и резюме
- Необходимо регулярное тестирование новых функций перед развертыванием
- Все изменения документируются в соответствии с правилами разработки

## Задача: CI/CD деплой на VPS через GitHub Actions (e77.top)
- **Статус**: В процессе
- **Описание**: Настроить автоматический деплой Next.js-приложения на сервер Ubuntu в каталог /www/wwwroot/e77.top при пуше в main: сборка в Actions, упаковка артефактов, загрузка на VPS, установка зависимостей, перезапуск через pm2.
- **Шаги выполнения**:
  - [x] Актуализировать документацию (changelog, plan)
  - [ ] Обновить next.config.js: переписать rewrite /api на http://localhost:8081
  - [ ] Перевести API на относительные пути в app/config/api.ts: API_BASE_URL = ''
  - [ ] Добавить workflow .github/workflows/deploy.yml (сборка, архив, SCP, SSH, pm2 e77-top)
  - [ ] Настроить секреты репозитория: VPS_HOST, VPS_USER, VPS_SSH_KEY
  - [ ] Настроить Nginx: e77.top → 127.0.0.1:4000; выпустить сертификат Let's Encrypt
  - [ ] Тестовый деплой и проверка статуса процесса pm2 (e77-top)
- **Зависимости**: pm2 установлен на сервере; доступ по SSH-ключу; бэкенд доступен на localhost:8081

## Задача: Приведение формы вакансии к структуре БД
- **Статус**: В процессе
- **Описание**: Привести `app/employer/vacancies/page.tsx` и типы/пайлоады к таблице `public.job_postings`, добавить поля для связей (vacancy_day_lengths, vacancy_employment_types, vacancy_cities, vacancy_education_types, vacancy_regions, vacancy_shift_types, vacancy_work_formats, vacancy_work_schedule_types, vacancy_work_schedules), подгружать enum-значения из БД.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Обнови
  - [x] Получить значения справочников из БД (employment_types, education_types, work_formats, work_schedule_types, work_schedules, work_day_lengths, shift_types) и сохранить в `app/config/*.json`
  - [x] Получить enum-значения (experience_level, work_experience, salary_type, salary_period, salary_frequency)
  - [ ] Обновить тип `JobPosting`/`JobUpsertPayload` и методы API для поддержки связанных полей (массивы id) и `work_experience`
  - [x] Обновить форму на `app/employer/vacancies/page.tsx`: добавить скролл модалки, убрать «Дата окончания публикации», заменить 6 полей на мультиселекты, добавить выпадающие списки для зарплаты
  - [x] Добавить мультиселект `work_schedules` и маппинг `*_ids`, `city_ids`, `region_ids` в `submitCreate/submitEdit`
  - [x] Добавить клиентскую валидацию (обязательные поля, диапазон зарплаты) и подсказки в форме
  - [x] Переключить `CityAutocomplete` на `/api/locations/cities/search`
  - [ ] Добавить поле «Опыт работы» (обязательное), RU-лейблы/EN-значения, закрытие по клику вне
  - [ ] Ручное тестирование create/update с новыми полями
- **Зависимости**: Строка подключения к PostgreSQL для MCP; поддержка бэкендом массивов ID и `work_experience` в payload вакансии

## Задача: Форма вакансии — «Адрес компании» (одиночный выбор)
- **Статус**: В процессе
- **Описание**: Заменить поле ввода ID на одиночный выпадающий список адресов компании, получаемых с `/api/companies/profile` (GET). В payload отправлять `company_address_id` (число), контракт бэкенда не меняется.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Загрузить адреса компании из `/api/companies/profile`
  - [ ] Реализовать выпадающий список с одиночным выбором и установкой `company_address_id`
  - [ ] Обновить валидацию и UX (показ названия города в метке)
  - [ ] Ручное тестирование создания/редактирования вакансии
- **Зависимости**: Авторизация (Bearer), наличие адресов в профиле компании

## Задача: Форма вакансии — единый UX мультивыборов
- **Статус**: В процессе
- **Описание**: Заменить нативные `<select multiple>` на выпадающие мультисписки с чекбоксами для полей: тип занятости, уровень образования, формат работы, график работы, расписание, часов в день, смены. Использовать источники из `app/config/*.json`.
- **Шаги выполнения**:
  - [x] Обновить документацию (changelog, plan)
  - [ ] Реализовать выпадающий мультивыбор для `employment_type_ids`
  - [ ] Реализовать выпадающий мультивыбор для `education_type_ids`
  - [ ] Реализовать выпадающий мультивыбор для `work_format_ids`
  - [ ] Реализовать выпадающий мультивыбор для `work_schedule_type_ids`
  - [ ] Реализовать выпадающий мультивыбор для `work_schedule_ids`
  - [ ] Реализовать выпадающий мультивыбор для `day_length_ids`
  - [ ] Реализовать выпадающий мультивыбор для `shift_type_ids`
- **Зависимости**: Источники справочников в `app/config/*.json`

## Примечания:
- Проект развивается поэтапно, начиная с фронтенда и постепенно добавляя бэкенд функциональность
- Текущий приоритет - завершение системы управления вакансиями и резюме
- Необходимо регулярное тестирование новых функций перед развертыванием
- Все изменения документируются в соответствии с правилами разработки
